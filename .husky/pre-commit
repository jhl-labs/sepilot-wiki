#!/bin/bash

# ë¯¼ê° ì •ë³´ ë…¸ì¶œ ê²€ì‚¬
echo "ðŸ” ë¯¼ê° ì •ë³´ ê²€ì‚¬ ì¤‘..."

# ìŠ¤í…Œì´ì§€ëœ íŒŒì¼ ëª©ë¡
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|json|yml|yaml|md)$' || true)

if [ -n "$STAGED_FILES" ]; then
    # í™ˆ ë””ë ‰í† ë¦¬ ê²½ë¡œ íŒ¨í„´ ê²€ì‚¬ (ì‹¤ì œ ìœ ì € ê²½ë¡œ)
    if echo "$STAGED_FILES" | xargs grep -lE '/home/[a-zA-Z0-9_]+/' 2>/dev/null; then
        echo "âŒ í™ˆ ë””ë ‰í† ë¦¬ ê²½ë¡œê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo "ì»¤ë°‹ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤. ë¯¼ê° ì •ë³´ë¥¼ ì œê±°í•œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."
        exit 1
    fi

    # API í‚¤/ë¹„ë°€ë²ˆí˜¸ íŒ¨í„´ ê²€ì‚¬
    if echo "$STAGED_FILES" | xargs grep -lE '(password|api[_-]?key|secret)\s*[:=]\s*["\x27][^"\x27]+' 2>/dev/null; then
        echo "âŒ API í‚¤ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo "ì»¤ë°‹ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤. ë¯¼ê° ì •ë³´ë¥¼ ì œê±°í•œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."
        exit 1
    fi
fi

echo "âœ… ë¯¼ê° ì •ë³´ ê²€ì‚¬ í†µê³¼"

# lint ê²€ì‚¬ (package.jsonì´ ìžˆëŠ” ê²½ìš°)
if [ -f "package.json" ]; then
    echo "ðŸ” ë¦°íŠ¸ ê²€ì‚¬ ì¤‘..."
    if command -v bun &> /dev/null; then
        bun run lint --quiet 2>/dev/null || true
    elif command -v npm &> /dev/null; then
        npm run lint --quiet 2>/dev/null || true
    fi
fi

echo "âœ… pre-commit ê²€ì‚¬ ì™„ë£Œ"
