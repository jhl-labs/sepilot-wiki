#!/bin/sh

# ë¯¼ê° ì •ë³´ ë…¸ì¶œ ê²€ì‚¬
echo "ðŸ” ë¯¼ê° ì •ë³´ ê²€ì‚¬ ì¤‘..."

# ì‚¬ìš©ìžëª…, IP, í˜¸ìŠ¤íŠ¸ ì •ë³´ íŒ¨í„´ ê²€ì‚¬
SENSITIVE_PATTERNS=(
    '/home/[a-zA-Z0-9_]+/'
    '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'
    'password\s*=\s*["\x27][^"\x27]+'
    'api[_-]?key\s*=\s*["\x27][^"\x27]+'
    'secret\s*=\s*["\x27][^"\x27]+'
)

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|json|yml|yaml|md)$')

if [ -n "$STAGED_FILES" ]; then
    for pattern in "${SENSITIVE_PATTERNS[@]}"; do
        if echo "$STAGED_FILES" | xargs grep -lE "$pattern" 2>/dev/null; then
            echo "âŒ ë¯¼ê° ì •ë³´ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!"
            echo "íŒ¨í„´: $pattern"
            echo "ì»¤ë°‹ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤. ë¯¼ê° ì •ë³´ë¥¼ ì œê±°í•œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."
            exit 1
        fi
    done
fi

echo "âœ… ë¯¼ê° ì •ë³´ ê²€ì‚¬ í†µê³¼"

# lint ê²€ì‚¬ (package.jsonì´ ìžˆëŠ” ê²½ìš°)
if [ -f "package.json" ]; then
    echo "ðŸ” ë¦°íŠ¸ ê²€ì‚¬ ì¤‘..."
    bun run lint --quiet 2>/dev/null || true
fi

echo "âœ… pre-commit ê²€ì‚¬ ì™„ë£Œ"
