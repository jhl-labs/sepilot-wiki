{
  "title": "vite-plugin-pwa 로 PWA 설정 및 배포 가이드",
  "slug": "vite-plugin-pwa-pwa",
  "content": "\n## 1. 개요 및 목적\n이 문서는 **vite-plugin-pwa** 를 활용해 Vite 기반 웹 애플리케이션에 오프라인·앱‑같은 경험을 제공하는 PWA(Progressive Web App)를 설정하고 배포하는 절차를 정리합니다.  \n- **대상**: Vite 프로젝트를 유지·보수하는 개발자·운영팀  \n- **목표**: 서비스 워커와 매니페스트를 올바르게 구성해 업데이트 실패·보안 이슈를 방지하고, 배포 파이프라인에 검증 절차를 포함시키는 것  \n\nPWA는 *웹 애플리케이션 매니페스트*와 *서비스 워커* 로 구성된다는 점이 기본이며, 이를 통해 브라우저는 오프라인 캐시와 설치 가능한 UI를 제공한다는 점이 공식 가이드에 명시되어 있습니다【Getting Started | Guide - Vite PWA】.\n\n## 2. 사전 준비\n| 항목 | 내용 | 비고 |\n|------|------|------|\n| Vite 프로젝트 구조 | `src/`, `public/`, `vite.config.ts`(또는 .js) 기본 레이아웃 | 기존 프로젝트에 `vite.config.*` 파일이 있어야 함 |\n| Node.js / npm | 최소 버전은 공식 Vite 요구사항에 따름(구체적 버전은 **추가 조사 필요**). |\n| 브라우저 호환성 | Chrome, Edge, Safari(모바일) 등 최신 브라우저에서 Service Worker와 Manifest를 지원해야 함. | MDN Service Worker 호환표 참고【MDN Web Docs – Service Worker】 |\n| 기존 Service Worker / Manifest 존재 여부 | `public/manifest.json` 혹은 `src/sw.*` 파일이 있는지 확인. 존재한다면 충돌 방지를 위해 삭제하거나 이름을 변경. | **추가 조사 필요** |\n\n## 3. vite-plugin-pwa 설치 및 초기 설정\n1. **플러그인 설치**  \n   ```bash\n   npm i -D vite-plugin-pwa\n   ```  \n   (또는 `yarn add -D vite-plugin-pwa`, `pnpm add -D vite-plugin-pwa`)  \n\n2. **vite.config.ts**에 플러그인 추가 (예시)  \n   ```ts\n   import { defineConfig } from 'vite'\n   import { VitePWA } from 'vite-plugin-pwa'\n\n   export default defineConfig({\n     plugins: [\n       VitePWA({\n         registerType: 'autoUpdate',\n         injectRegister: 'script',\n         workbox: {\n           // 기본 워크박스 옵션은 generateSW 모드에서 자동 생성\n         }\n       })\n     ]\n   })\n   ```  \n   - `registerType` : 자동 업데이트 방식 지정 (`autoUpdate` 권장)  \n   - `injectRegister` : HTML에 Service Worker 등록 스크립트를 삽입 (`script` 또는 `inline`)  \n   - `workbox` : 캐시 전략 등 세부 옵션을 정의할 수 있음【Getting Started | Guide - Vite PWA】  \n\n## 4. 웹 애플리케이션 매니페스트 구성\n`public/manifest.json` (또는 플러그인 옵션 `manifest`)에 다음 필드를 포함합니다.\n\n| 필드 | 설명 | 권장값 |\n|------|------|--------|\n| `name` | 전체 앱 이름 | 예: `\"My Awesome App\"` |\n| `short_name` | 홈 화면 아이콘에 표시될 짧은 이름 | 예: `\"MyApp\"` |\n| `start_url` | 앱 실행 시 시작 URL | `/` |\n| `display` | 앱 실행 모드 (`standalone`, `fullscreen`, `minimal-ui`, `browser`) | `standalone` |\n| `icons` | 다양한 사이즈·포맷의 아이콘 배열 | 48×48, 96×96, 192×192, 512×512 PNG 권장 |\n| `theme_color` | 브라우저 UI 색상 | `#ffffff` 등 |\n| `background_color` | 스플래시 화면 배경색 | `#ffffff` 등 |\n| `orientation` | 화면 방향 제한 (`portrait`, `landscape`) | 필요 시 지정 |\n\n다국어 매니페스트는 `lang` 필드와 별도 파일을 활용해 관리할 수 있으나, 구체적인 구현 방법은 **추가 조사 필요**합니다.\n\n## 5. Service Worker 설정 및 워크박스 전략\n`vite-plugin-pwa`는 두 가지 모드(`generateSW`, `injectManifest`)를 제공합니다.\n\n### 기본 `workbox` 옵션 구조\n```ts\nworkbox: {\n  runtimeCaching: [\n    {\n      urlPattern: ({ url }) => url.origin === self.location.origin && url.pathname.endsWith('.js'),\n      handler: 'CacheFirst',\n      options: {\n        cacheName: 'static-js',\n        expiration: { maxEntries: 100, maxAgeSeconds: 60 * 60 * 24 * 30 }\n      }\n    },\n    {\n      urlPattern: ({ url }) => url.origin === 'https://api.example.com',\n      handler: 'NetworkFirst',\n      options: {\n        cacheName: 'api-data',\n        networkTimeoutSeconds: 10,\n        expiration: { maxEntries: 50, maxAgeSeconds: 60 * 5 }\n      }\n    }\n  ],\n  skipWaiting: true,\n  clientsClaim: true\n}\n```  \n- `runtimeCaching` : 정적 자산과 동적 API 캐시를 구분해 `CacheFirst`, `NetworkFirst`, `StaleWhileRevalidate` 등 전략을 지정합니다.  \n- `skipWaiting` / `clientsClaim` : 새 Service Worker가 즉시 활성화되고 현재 페이지에 적용되도록 합니다.  \n\n### 커스텀 Service Worker 파일\n플러그인 옵션 `srcDir: 'src'`와 `filename: 'sw.ts'` 로 커스텀 파일을 작성하고, `injectManifest` 모드에서 사용합니다. 구체적인 파일 구조는 **추가 조사 필요**합니다.\n\n## 6. 빌드 단계와 캐시 버전 관리\n- `vite build` 실행 시 플러그인이 `manifest.json`과 Service Worker 파일을 **해시가 포함된 파일명**으로 자동 생성합니다.  \n- `precache` 매니페스트에 포함된 각 파일은 `revision`(해시) 값으로 버전 관리되며, 파일 내용이 바뀌면 새로운 해시가 생성되어 캐시 무효화가 자동으로 이루어집니다【Getting Started | Guide - Vite PWA】.  \n- UI에서 업데이트를 감지하려면 `self.update()` 를 호출하거나, 플러그인 제공 `registerSW` 옵션의 `onNeedRefresh` 콜백을 활용합니다.\n\n## 7. 업데이트 알림 및 사용자 경험 흐름\n```ts\nregisterSW({\n  onNeedRefresh() {\n    // 사용자에게 업데이트 알림 UI 표시 (Toast, Modal 등)\n  },\n  onOfflineReady() {\n    // 오프라인 사용 가능 알림\n  }\n})\n```  \n- **자동 업데이트** : `registerType: 'autoUpdate'` 로 설정하면 새 SW가 자동으로 활성화됩니다.  \n- **수동 업데이트** : `onNeedRefresh` 에서 사용자가 “새로 고침” 버튼을 클릭하면 `window.location.reload()` 로 최신 버전을 로드합니다. 선택 기준은 서비스 특성(실시간 데이터 vs 정적 콘텐츠) 에 따라 결정합니다.\n\n## 8. 로컬·스테이징·프로덕션 환경별 설정 차이\n| 환경 | Service Worker | 캐시 전략 | 권장 플러그인 모드 |\n|------|----------------|-----------|-------------------|\n| **dev** | 비활성화 (`devOptions: { enabled: false }`) | 최소 캐시 | `generateSW` 사용 권장 |\n| **staging** | 활성화, `skipWaiting: false` | 짧은 TTL(예: 1시간) | `injectManifest` 로 커스텀 로직 적용 |\n| **production** | 활성화, `skipWaiting: true`, `clientsClaim: true` | 장기 캐시 + 정기 버전 업데이트 | `injectManifest` (복잡한 캐시 제어 필요 시) 또는 `generateSW` (간단한 경우) |\n\n## 9. 테스트 및 검증\n1. **Chrome DevTools → Application** 탭에서  \n   - `Manifest` 섹션: 이름, 아이콘, start_url 등 확인  \n   - `Service Workers` 섹션: 상태(activated), `skipWaiting` 여부 확인  \n2. **오프라인 모드 테스트**  \n   - DevTools → Network → Offline 로 전환 후 페이지 새로고침 → 정상 동작 여부 확인  \n3. **Lighthouse** 로 PWA 점수 측정 (최소 90점 목표)  \n   - 주요 개선 포인트: `manifest` 완전성, `serviceWorker` 등록, `HTTPS` 적용 등  \n4. **CI 파이프라인** 예시  \n   ```bash\n   npm run build && npm run preview &\n   # preview 서버에서 Cypress 혹은 Playwright 로 오프라인 시나리오 자동 검증\n   ```\n\n## 10. 배포 전략\n- **정적 호스팅** (Netlify, Vercel, Cloudflare Pages) 은 Service Worker 파일을 그대로 제공하므로, `Cache-Control: no-cache` 헤더를 매니페스트와 SW 파일에 적용해 최신 버전 배포를 보장합니다.  \n- **HTTPS** 는 PWA 동작 필수 조건이며, HSTS(`Strict-Transport-Security`) 를 설정해 강제 HTTPS 전환을 권장합니다.  \n- **롤백** 시 기존 캐시를 정리하려면 `self.registration.unregister()` 를 호출하거나, 배포 시 `Cache-Control: max-age=0` 로 강제 재검증을 수행합니다.\n\n## 11. 보안 및 프라이버시 고려사항\n| 항목 | 권장 설정 |\n|------|-----------|\n| Service Worker 범위 | `scope` 를 `/` 로 제한하거나, 서브 디렉터리 별로 별도 SW를 두어 불필요한 파일 접근 차단 |\n| 민감 데이터 캐시 방지 | API 응답에 `Cache-Control: no-store` 헤더 적용 |\n| 매니페스트 보안 플래그 | `prefer_related_applications: false` 등 필요 시 설정 |\n| CSP 연동 | `script-src 'self'` 와 `worker-src 'self'` 를 명시해 악성 SW 로드 방지【MDN Web Docs – Service Worker】 |\n\n## 12. 트러블슈팅 FAQ\n**Q1. Service Worker 등록이 실패한다**  \n- 원인: HTTPS 미적용, `scope` 오류, 파일 경로 오타 등  \n- 해결: HTTPS 적용 여부 확인, `vite.config.ts` 의 `registerType` 과 `injectRegister` 옵션 검토  \n\n**Q2. 캐시가 업데이트되지 않는다**  \n- 점검 항목: `workbox.runtimeCaching` 의 `revision` 값(해시) 확인, `skipWaiting`/`clientsClaim` 설정 여부, 브라우저 캐시 강제 새로고침 (`Ctrl+Shift+R`)  \n\n**Q3. manifest.json 오류** (아이콘 누락, 필드 오탈자)  \n- 대응: DevTools → Application → Manifest 에서 오류 메시지 확인, 필수 필드(`name`, `short_name`, `icons`)가 모두 존재하는지 검증  \n\n**Q4. 빌드 후 파일 해시가 변하지 않는다**  \n- 원인: 캐시 무시 옵션(`cacheBust`) 미설정, `vite-plugin-pwa` 가 `injectManifest` 모드에서 정적 파일을 그대로 복사하는 경우  \n- 해결: `generateSW` 모드 사용 검토 또는 `workbox` 의 `cleanupOutdatedCaches` 옵션 활성화  \n\n## 13. 참고 자료 및 링크\n- **vite-plugin-pwa 공식 가이드** – [Getting Started | Guide - Vite PWA](https://vite-pwa-org.netlify.app/guide/)  \n- **Vite 공식 문서** – <https://vitejs.dev/>  \n- **MDN Web Docs – Service Worker** – <https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API>  \n- **MDN Web Docs – Web App Manifest** – <https://developer.mozilla.org/en-US/docs/Web/Manifest>  \n- **Progressive Web App (PWA) with Vite : Development Guide** – <https://dev.to/hamdankhan364/simplifying-progressive-web-app-pwa-development-with-vite-a-beginners-guide-38cf>  \n- **Vite 환경에서 PWA 구축 예시** – <https://githws.github.io/til/pwa-with-vite/>  \n\n*본 문서는 위에 열거된 공식 자료와 커뮤니티 글을 기반으로 작성되었습니다. 특정 버전·옵션에 대한 상세 내용은 해당 자료를 추가로 검토하시기 바랍니다.*",
  "lastModified": "2026-03-01T12:08:58Z",
  "author": "SEPilot AI",
  "status": "published",
  "isDraft": false,
  "isInvalid": false,
  "tags": [
    "vite",
    "vite-plugin-pwa",
    "PWA",
    "오프라인",
    "서비스워커",
    "매니페스트"
  ],
  "history": [
    {
      "sha": "c31fc20",
      "message": "chore: Issue Processor 실행 결과",
      "author": "GitHub Action",
      "authorEmail": "action@github.com",
      "date": "2026-03-01T12:08:58Z",
      "isAutoCommit": false,
      "additions": 0,
      "deletions": 0
    }
  ]
}