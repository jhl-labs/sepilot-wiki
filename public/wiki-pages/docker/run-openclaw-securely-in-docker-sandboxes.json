{
  "title": "Run OpenClaw Securely in Docker Sandboxes",
  "slug": "docker/run-openclaw-securely-in-docker-sandboxes",
  "content": "\n## 1. 문서 개요\n**목적**  \nDocker Sandboxes 를 활용해 OpenClaw 를 안전하게 실행하는 방법을 단계별로 안내합니다.  \n\n**대상 독자**  \n- AI 에이전트·코딩 도구를 운영하는 개발자·DevOps 엔지니어  \n- 컨테이너 보안·격리 환경을 설계·운영하는 보안 담당자  \n\n**기대 효과와 적용 범위**  \n- 마이크로‑VM 기반 격리로 호스트 시스템 침해 위험 최소화  \n- 네트워크 프록시를 통한 외부 연결 차단 및 API 키 자동 주입으로 비밀 정보 보호  \n- 로컬 모델 사용 시 클라우드 비용 전혀 발생하지 않음  \n\n---\n\n## 2. Docker Sandboxes 소개\n- **마이크로‑VM 기반 격리 원리**  \n  Docker Sandboxes 는 기존 컨테이너보다 더 가벼운 마이크로‑VM 위에 워크로드를 배치해, 하이퍼바이저 수준의 격리를 제공합니다.  \n\n- **기존 컨테이너와의 차별점**  \n  - 컨테이너는 커널 네임스페이스 공유에 비해, Sandbox 은 별도 가상화 레이어를 사용해 공격 표면을 크게 축소합니다.  \n  - 네트워크 프록시가 기본 제공되어, 임의의 인터넷 호스트와의 연결을 명시적으로 허용하지 않으면 차단됩니다.  \n\n- **주요 보안 특성**  \n  - **네트워크 프록시**: 외부 연결을 deny‑list 혹은 allow‑list 방식으로 제어합니다.  \n  - **키 주입 차단**: API 키(예: `ANTHROPIC_API_KEY`, `OPENAI_API_KEY`)는 프록시가 주입하고, 에이전트는 직접 접근할 수 없습니다.  \n  - **파일 시스템 제한**: 워크스페이스 디렉터리만 마운트하고, 나머지는 읽기 전용 또는 차단됩니다.  \n\n(출처: Docker Blog, “Run OpenClaw Securely in Docker Sandboxes”[[링크]](https://www.docker.com/blog/run-openclaw-securely-in-docker-sandboxes/))\n\n---\n\n## 3. OpenClaw 개요\n- **정의 및 활용 시나리오**  \n  OpenClaw 은 오픈소스 AI 코딩 에이전트로, 사용자가 입력한 요구사항을 코드로 변환해 줍니다. 로컬 모델 또는 클라우드 모델을 백엔드로 사용할 수 있습니다.  \n\n- **로컬 모델 vs 클라우드 모델**  \n  - *로컬 모델*: Docker Model Runner 에서 실행되는 `ai/gpt-oss:20B-UD-Q4_K_XL` 등. 비용이 들지 않으며 데이터가 외부로 유출되지 않음.  \n  - *클라우드 모델*: OpenAI, Anthropic 등 외부 API 사용 시 비용이 발생하고, API 키 관리가 필요함.  \n\n- **보안 위험 요소 요약**  \n  - API 키 노출 위험 (클라우드 모델 사용 시)  \n  - 외부 네트워크 접근을 통한 악성 호출 가능성  \n  - 워크스페이스 파일 시스템에 대한 무제한 쓰기 권한  \n\n(출처: Docker Blog[[링크]](https://www.docker.com/blog/run-openclaw-securely-in-docker-sandboxes/))\n\n---\n\n## 4. 사전 준비\n1. **Docker Desktop 최신 버전 설치** – Docker Desktop 4.x 이상 권장.  \n2. **Docker Model Runner 활성화**  \n   - Docker Desktop → Settings → Docker Model Runner → **Enable** 체크.  \n3. **필요 이미지 및 모델 사전 다운로드**  \n   ```bash\n   docker model pull ai/gpt-oss:20B-UD-Q4_K_XL\n   ```  \n   (위 명령은 Docker Model Runner 에서 로컬 모델을 다운로드합니다.)  \n\n---\n\n## 5. Sandbox 생성 및 초기 설정\n- **Sandbox 생성 명령**  \n  ```bash\n  docker sandbox create --name openclaw -t olegselajev241/openclaw-dmr:latest shell .\n  ```  \n  - `--name` : Sandbox 식별자  \n  - `-t` : 사용할 이미지 (OpenClaw‑DMR)  \n  - `shell .` : 현재 디렉터리를 워크스페이스로 마운트  \n\n- **워크스페이스 디렉터리 마운트 정책**  \n  - 기본적으로 현재 디렉터리(`.`)만 마운트되며, 읽기/쓰기 권한은 이미지 내부 설정에 따릅니다.  \n\n- **기본 파일 시스템 권한 설정**  \n  - 필요 시 `read_only: true` 옵션을 추가해 전체 파일 시스템을 읽기 전용으로 전환할 수 있습니다(추가 조사 필요).  \n\n---\n\n## 6. 네트워크 프록시 구성\n- **프록시를 통한 외부 연결 차단 원리**  \n  프록시는 모든 outbound 트래픽을 가로채고, 허용된 호스트만 통과시킵니다.  \n\n- **프록시 설정 명령**  \n  ```bash\n  docker sandbox network proxy openclaw --allow-host localhost\n  ```  \n  - `--allow-host localhost` : 로컬 호스트만 허용, 기타 모든 외부 연결 차단  \n\n- **허용 호스트 화이트리스트 설정 방법**  \n  `--allow-host` 옵션에 콤마 구분으로 여러 호스트를 추가 가능 (예: `--allow-host localhost,api.minimax.chat`).  \n\n- **API 키 자동 주입 메커니즘 및 보안 고려사항**  \n  - 호스트 환경 변수에 `ANTHROPIC_API_KEY` 혹은 `OPENAI_API_KEY` 가 설정돼 있으면 프록시가 이를 에이전트에게 주입합니다.  \n  - 에이전트는 키를 직접 읽을 수 없으며, 프록시가 요청 시 헤더에 삽입합니다.  \n  - 키가 필요 없는 로컬 모델 사용 시, 키를 설정하지 않아도 안전하게 실행됩니다.  \n\n(출처: Docker Blog[[링크]](https://www.docker.com/blog/run-openclaw-securely-in-docker-sandboxes/))\n\n---\n\n## 7. OpenClaw 실행 단계\n1. **Sandbox 실행**  \n   ```bash\n   docker sandbox run openclaw\n   ```  \n2. **Sandbox 내부 진입**  \n   ```bash\n   ~/start-openclaw.sh\n   ```  \n   - 위 스크립트는 OpenClaw 의 터미널 UI 를 시작하고, 로컬 모델(`gpt-oss`)에 연결합니다.  \n\n3. **모델 로드 및 인터랙션 흐름**  \n   - OpenClaw 가 시작되면, 사용자는 프롬프트를 입력해 코드를 생성하도록 요청합니다.  \n   - 모델은 Docker Model Runner 에서 실행 중인 로컬 모델에 질의하고, 결과를 반환합니다.  \n\n4. **로컬 ↔ 클라우드 모델 전환**  \n   - 프록시가 자동으로 API 키를 주입하면, OpenClaw 는 클라우드 모델(예: OpenAI) 로도 전환 가능합니다.  \n   - 전환을 원할 경우 `ANTHROPIC_API_KEY` 혹은 `OPENAI_API_KEY` 를 호스트에 설정하고, 프록시를 재구성하면 됩니다.  \n\n---\n\n## 8. 보안 강화 베스트 프랙티스\n- **읽기 전용 파일 시스템 적용**  \n  `read_only: true` 옵션을 사용해 워크스페이스 외 파일 시스템을 차단합니다.  \n\n- **사용자 및 권한 제한**  \n  ```bash\n  user: \"1001:1001\"\n  ```  \n  비루트 사용자로 실행해 권한 상승 위험을 감소시킵니다.  \n\n- **gVisor / runsc 등 추가 격리 레이어 활용**  \n  Docker Compose 예시(외부 참고)에서는 `runtime: runsc` 로 gVisor 를 적용해 커널 수준 격리를 강화합니다. (추가 조사 필요)  \n\n- **환경 변수와 시크릿 관리 전략**  \n  - 시크릿은 Docker `secrets` 기능을 이용해 파일 시스템에 직접 노출되지 않도록 합니다.  \n  - API 키는 프록시가 주입하도록 하고, 컨테이너 내부에서는 환경 변수로 노출되지 않게 합니다.  \n\n(출처: Docker Blog[[링크]](https://www.docker.com/blog/run-openclaw-securely-in-docker-sandboxes/), AdvenBoost “OpenClaw Docker: Hardening Your AI Sandbox”)\n\n---\n\n## 9. 모니터링 및 로깅\n- **Sandbox 내부 로그 수집**  \n  - `docker sandbox logs openclaw` 명령으로 표준 출력/오류 로그를 확인합니다.  \n\n- **네트워크 트래픽 모니터링 설정**  \n  - 프록시 로그를 활성화하면 허용/차단된 요청 내역을 파일에 기록할 수 있습니다.  \n\n- **이상 행동 탐지를 위한 알림 구성**  \n  - 로그 분석 도구(예: Loki, Prometheus)와 연동해 비정상적인 연결 시도나 파일 쓰기 패턴을 알림으로 전송합니다.  \n\n---\n\n## 10. 문제 해결 가이드\n| 오류 | 원인 | 해결 방법 |\n|------|------|----------|\n| 모델 다운로드 실패 | `docker model pull` 네트워크 차단 | 프록시 허용 호스트에 모델 레지스트리 URL 추가 후 재시도 |\n| 프록시 설정 오류 | `--allow-host` 옵션 누락 | 올바른 호스트(예: `localhost`)를 명시하고 `docker sandbox network proxy` 재실행 |\n| OpenClaw 실행 중 권한 오류 | 컨테이너가 루트가 아닌 사용자로 실행 | `user` 옵션을 확인하거나 `--privileged` 없이 실행 |\n| API 키 주입 안됨 | 호스트에 환경 변수 미설정 | `ANTHROPIC_API_KEY` 혹은 `OPENAI_API_KEY` 를 호스트에 export 후 프록시 재시작 |\n\n- **디버깅 명령어**  \n  - `docker sandbox exec openclaw cat /etc/os-release` – 내부 OS 확인  \n  - `docker sandbox logs openclaw --tail 100` – 최근 로그 확인  \n\n- **복구 절차와 재배포 전략**  \n  1. 기존 Sandbox 삭제: `docker sandbox rm openclaw`  \n  2. 이미지 최신화: `docker pull olegselajev241/openclaw-dmr:latest`  \n  3. 위 섹션 5‑7 의 절차를 재실행  \n\n---\n\n## 11. FAQ\n**Q: API 키가 노출될 위험은?**  \nA: 프록시가 키를 헤더에 삽입하고, 컨테이너 내부에서는 환경 변수로 존재하지 않으므로 직접 노출되지 않습니다. 로컬 모델을 사용할 경우 키 자체가 필요 없으므로 위험이 없습니다.  \n\n**Q: 클라우드 모델을 사용할 때 비용 절감 방법은?**  \nA: 가능한 경우 로컬 모델(`gpt-oss`)을 우선 사용하고, 클라우드 모델은 필요 시에만 API 키를 설정해 제한된 호출만 허용하도록 화이트리스트를 구성합니다.  \n\n**Q: Sandbox와 기존 Docker Compose 환경을 함께 사용할 수 있나요?**  \nA: 네. Sandbox 를 별도 서비스로 정의하고, Docker Compose 파일에서 `depends_on` 등으로 연동할 수 있습니다. 다만 네트워크와 파일 시스템 마운트 정책을 명확히 구분해야 합니다.  \n\n---\n\n## 12. 참고 자료 및 링크\n- Docker 공식 블로그 포스트: **Run OpenClaw Securely in Docker Sandboxes** [[링크]](https://www.docker.com/blog/run-openclaw-securely-in-docker-sandboxes/)  \n- OpenClaw GitHub 레포지토리: https://github.com/openclaw/openclaw (추가 조사 필요)  \n- Docker Bench for Security: https://github.com/docker/docker-bench-security  \n- 커뮤니티 토론 및 사례 연구:  \n  - Reddit “프로덕션 환경에서 OpenClaw를 실행하는 가장 안전한 방법” (한국어)  \n  - AdvenBoost “OpenClaw Docker: Hardening Your AI Sandbox for Production 2026” (Docker‑compose 예시)  \n\n---",
  "lastModified": "2026-02-25T17:45:21+09:00",
  "author": "SEPilot AI",
  "status": "published",
  "isDraft": false,
  "isInvalid": false,
  "tags": [
    "Docker",
    "Sandbox",
    "OpenClaw",
    "Security",
    "AI Agents"
  ],
  "history": [
    {
      "sha": "ca90870",
      "message": "chore(deps): bump ioredis from 5.9.2 to 5.9.3 (#172)",
      "author": "dependabot[bot]",
      "authorEmail": "49699333+dependabot[bot]@users.noreply.github.com",
      "date": "2026-02-25T17:45:21+09:00",
      "isAutoCommit": false,
      "additions": 0,
      "deletions": 0
    }
  ]
}