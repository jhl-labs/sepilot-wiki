{
  "title": "$100k AWS 라우팅 함정: S3 + NAT 게이트웨이 비용 최적화 가이드",
  "slug": "cloud/aws-cost-optimization",
  "content": "\n## 1. 개요\n이 문서는 **AWS VPC** 환경에서 **프라이빗 서브넷**에 배치된 EC2 인스턴스가 **S3**에 접근할 때 발생할 수 있는 비용 폭증 현상을 진단하고, **Terraform**을 활용한 비용 절감 방안을 제시합니다.  \n대상 독자는 AWS 인프라를 설계·운영하는 엔지니어, 비용 관리 담당자, 그리고 Terraform 기반 IaC를 도입하려는 팀입니다.\n\n**핵심 이슈**  \n- 프라이빗 서브넷 → NAT Gateway → 인터넷 → 퍼블릭 S3 엔드포인트 로우팅으로 인해 **데이터가 AWS 백본을 두 번 떠나게** → 아웃바운드 트래픽이 **2배** 청구됨.  \n- NAT Gateway 사용 시 **시간당 가동 비용**과 **GB당 $0.045**의 처리 수수료가 추가되어 비용이 급증함.  \n- 해결책은 **VPC Gateway Endpoint**(S3 전용)를 도입해 트래픽을 AWS 내부로 제한하는 것임.  \n(출처: [euno.news](https://euno.news/posts/ko/the-100k-aws-routing-trap-s3-nat-gateways-and-how-307ce6))\n\n## 2. 전형적인 “Secure‑by‑Default” VPC 설계\n| 요소 | 설명 |\n|------|------|\n| **프라이빗 서브넷** | 퍼블릭 IP가 없는 EC2 인스턴스가 배치되어 외부 직접 접근이 차단됨. |\n| **NAT Gateway** | 프라이빗 서브넷의 아웃바운드 트래픽을 인터넷으로 라우팅하기 위해 사용됨. |\n| **라우팅 테이블** | `0.0.0.0/0` → NAT Gateway → 인터넷 게이트웨이(IGW) → 퍼블릭 서비스(예: S3) 로 흐름을 정의. |\n\n이 설계는 보안 관점에서는 안전하지만, **데이터 전송 경로**가 비효율적일 경우 비용이 크게 증가합니다.\n\n## 3. 비용 폭증 원인 분석\n### 3.1 데이터 중력(Data Gravity)\n데이터가 저장된 위치(예: S3)와 이를 소비하는 컴퓨트 리소스 간의 거리(네트워크 홉)가 비용에 직접적인 영향을 미칩니다. 데이터가 **AWS 백본을 떠나** 외부 인터넷을 경유하면 두 번 과금됩니다.\n\n### 3.2 S3 퍼블릭 엔드포인트 사용 시 이중 egress\n- EC2 → NAT Gateway → 인터넷 게이트웨이 → **퍼블릭 S3 엔드포인트** 로 전송  \n- 데이터가 AWS 백본을 떠난 뒤 다시 **NAT Gateway** 로 돌아와야 하므로 **아웃바운드 트래픽이 2배** 청구됩니다.  \n- 예시: 하루에 **10 TB**를 다운로드하는 파이프라인이라면 실제 청구는 **20 TB**의 아웃바운드가 됩니다. (출처: euno.news)\n\n## 4. NAT Gateway 숨은 비용 상세\n| 비용 항목 | 설명 |\n|----------|------|\n| **시간당 가동 비용** | NAT Gateway는 가동 시간당 요금이 부과됩니다. 정확한 금액은 AWS 요금표에 명시되어 있으며, 사용량에 따라 청구됩니다. |\n| **GB당 처리 수수료** | 데이터 처리량에 대해 **$0.045/GB**가 추가됩니다. |\n| **표준 인터넷 아웃바운드 요금** | AWS 외부로 나가는 트래픽에 대해 일반 인터넷 요금이 적용됩니다. |\n\n이 세 가지 비용이 복합적으로 작용해 **수십만 달러** 규모의 비용이 발생할 수 있습니다.\n\n## 5. 비용 절감 솔루션: VPC Gateway Endpoint for S3\n### 5.1 엔드포인트 개념 및 작동 원리\n- **VPC Gateway Endpoint**는 VPC와 S3 사이에 **프라이빗 연결**을 생성합니다.  \n- 트래픽이 **AWS 백본 내부**에 머무르며, NAT Gateway를 우회합니다.  \n- 내부 전송 비용은 **$0.00**이며, NAT Gateway 사용에 따른 추가 비용도 사라집니다. (출처: euno.news)\n\n### 5.2 라우팅 경로 축소\n```\n기존 경로: Private Subnet → NAT GW → IGW → Public S3 → Internet → NAT GW\n새로운 경로: Private Subnet → VPC Endpoint (S3) → S3 (AWS 내부)\n```\n\n### 5.3 비용 효과 분석\n- **NAT Gateway 시간당 비용** 및 **GB당 $0.045** 수수료가 제거됩니다.  \n- **아웃바운드 트래픽**이 내부 전송으로 전환돼 **표준 인터넷 요금**도 사라집니다.  \n- 결과적으로 **데이터 전송 비용이 0**에 가깝게 감소합니다.\n\n## 6. Terraform을 활용한 구현 예시\n아래는 **Terraform**으로 S3 전용 VPC Gateway Endpoint를 정의하는 예시입니다. (코드 블록은 들여쓰기 형태로 제공)\n\n    resource \"aws_vpc_endpoint\" \"s3\" {\n      vpc_id            = aws_vpc.main.id\n      service_name      = \"com.amazonaws.${var.region}.s3\"\n      vpc_endpoint_type = \"Gateway\"\n    }\n\n### 적용 전후 차이점 검증 방법\n1. **Cost Explorer** 혹은 **AWS Billing Dashboard**에서 NAT Gateway 사용량과 데이터 전송량을 모니터링합니다.  \n2. 엔드포인트 적용 후 **NAT Gateway 트래픽**이 0에 가까워졌는지 확인합니다.  \n3. **VPC Flow Logs**를 통해 S3 트래픽이 `vpce-` 인터페이스를 경유하는지 검증합니다.\n\n## 7. 베스트 프랙티스 및 설계 가이드라인\n| 권장 사항 | 설명 |\n|----------|------|\n| **프라이빗 서브넷 → VPC 엔드포인트 우선 적용** | S3, DynamoDB 등 퍼블릭 서비스에 대한 트래픽은 반드시 엔드포인트로 라우팅합니다. |\n| **NAT Gateway 사용 최소화** | 반드시 외부 인터넷이 필요한 경우에만 NAT Gateway를 배치하고, 비용이 높은 경우 **NAT Instance** 혹은 **VPC Endpoint**로 대체합니다. |\n| **비용 모니터링 자동화** | CloudWatch **Metric Filter**와 **Billing Alarms**를 설정해 NAT Gateway 사용량 급증 시 알림을 받습니다. |\n| **Terraform CI/CD 파이프라인** | 인프라 변경 시 비용 영향을 자동 검증하도록 `terraform plan` 결과를 비용 시뮬레이션 도구와 연동합니다. |\n\n## 8. 추가 참고 자료\n- **오픈소스 라우팅 완화 모델**: `cloud‑egress‑patterns` (GitHub) – VPC 라우팅 최적화 패턴을 제공합니다.  \n- **크로스‑리전 VPC 피어링 비용 심층 분석**: *The Physics of Data Egress* (Rack2Cloud Control Plane) – 리전 간 데이터 전송 비용 구조를 설명합니다.  \n- **AWS 공식 문서**  \n  - VPC Endpoint: https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html  \n  - NAT Gateway 요금: https://aws.amazon.com/vpc/pricing/  \n\n## 9. 결론 및 권고 사항\n- **핵심 포인트**: 프라이빗 서브넷에서 S3에 접근할 때 NAT Gateway를 거치면 데이터가 두 번 egress되어 비용이 급증한다. VPC Gateway Endpoint를 도입하면 내부 전송으로 전환돼 비용을 사실상 0으로 만들 수 있다.  \n- **조직 차원의 정책**  \n  1. **정기 라우팅 리뷰**를 수행해 NAT → S3 경로가 존재하는지 점검한다.  \n  2. **Terraform 모듈**에 VPC Endpoint 리소스를 기본 포함시켜 인프라 표준화한다.  \n  3. **비용 알림**을 설정해 NAT Gateway 사용량 급증 시 즉시 대응한다.  \n- **향후 로드맵**: 엔드포인트 적용 후 **멀티리전 데이터 복제** 전략을 재검토하고, 필요 시 **Transit Gateway**와 결합해 전역 라우팅 최적화를 진행한다.  \n\n---  \n\n*본 문서는 자동 감지된 뉴스 인텔리전스를 기반으로 작성되었습니다.*",
  "lastModified": "2026-02-23T00:23:27Z",
  "author": "SEPilot AI",
  "status": "published",
  "isDraft": false,
  "isInvalid": false,
  "tags": [
    "AWS",
    "NAT Gateway",
    "Terraform",
    "Cost Optimization",
    "VPC Endpoint"
  ],
  "order": 1,
  "history": [
    {
      "sha": "ecef4ef",
      "message": "chore: 뉴스 인텔리전스 보고서 업데이트",
      "author": "GitHub Action",
      "authorEmail": "action@github.com",
      "date": "2026-02-23T00:23:27Z",
      "isAutoCommit": false,
      "additions": 0,
      "deletions": 0
    }
  ]
}