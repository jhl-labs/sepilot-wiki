{
  "title": "$100k AWS λΌμ°ν… ν•¨μ •: S3 + NAT κ²μ΄νΈμ›¨μ΄ λΉ„μ© μµμ ν™” κ°€μ΄λ“",
  "slug": "cloud/aws-cost-optimization",
  "content": "\n## 1. κ°μ”\nμ΄ λ¬Έμ„λ” **AWS VPC** ν™κ²½μ—μ„ **ν”„λΌμ΄λΉ— μ„λΈλ„·**μ— λ°°μΉλ EC2 μΈμ¤ν„΄μ¤κ°€ **S3**μ— μ ‘κ·Όν•  λ• λ°μƒν•  μ μλ” λΉ„μ© ν­μ¦ ν„μƒμ„ μ§„λ‹¨ν•κ³ , **Terraform**μ„ ν™μ©ν• λΉ„μ© μ κ° λ°©μ•μ„ μ μ‹ν•©λ‹λ‹¤.  \nλ€μƒ λ…μλ” AWS μΈν”„λΌλ¥Ό μ„¤κ³„Β·μ΄μν•λ” μ—”μ§€λ‹μ–΄, λΉ„μ© κ΄€λ¦¬ λ‹΄λ‹Ήμ, κ·Έλ¦¬κ³  Terraform κΈ°λ° IaCλ¥Ό λ„μ…ν•λ ¤λ” ν€μ…λ‹λ‹¤.\n\n**ν•µμ‹¬ μ΄μ**  \n- ν”„λΌμ΄λΉ— μ„λΈλ„· β†’ NAT Gateway β†’ μΈν„°λ„· β†’ νΌλΈ”λ¦­ S3 μ—”λ“ν¬μΈνΈ λ΅μ°ν…μΌλ΅ μΈν•΄ **λ°μ΄ν„°κ°€ AWS λ°±λ³Έμ„ λ‘ λ² λ– λ‚κ²**Β β†’Β μ•„μ›ƒλ°”μ΄λ“ νΈλν”½μ΄ **2λ°°** μ²­κµ¬λ¨.  \n- NAT Gateway μ‚¬μ© μ‹ **μ‹κ°„λ‹Ή κ°€λ™ λΉ„μ©**κ³Ό **GBλ‹Ή $0.045**μ μ²λ¦¬ μμλ£κ°€ μ¶”κ°€λμ–΄ λΉ„μ©μ΄ κΈ‰μ¦ν•¨.  \n- ν•΄κ²°μ±…μ€ **VPC Gateway Endpoint**(S3 μ „μ©)λ¥Ό λ„μ…ν•΄ νΈλν”½μ„ AWS λ‚΄λ¶€λ΅ μ ν•ν•λ” κ²ƒμ„.  \n(μ¶μ²: [euno.news](https://euno.news/posts/ko/the-100k-aws-routing-trap-s3-nat-gateways-and-how-307ce6))\n\n## 2. μ „ν•μ μΈ β€Secureβ€‘byβ€‘Defaultβ€ VPC μ„¤κ³„\n| μ”μ† | μ„¤λ… |\n|------|------|\n| **ν”„λΌμ΄λΉ— μ„λΈλ„·** | νΌλΈ”λ¦­ IPκ°€ μ—†λ” EC2 μΈμ¤ν„΄μ¤κ°€ λ°°μΉλμ–΄ μ™Έλ¶€ μ§μ ‘ μ ‘κ·Όμ΄ μ°¨λ‹¨λ¨. |\n| **NAT Gateway** | ν”„λΌμ΄λΉ— μ„λΈλ„·μ μ•„μ›ƒλ°”μ΄λ“ νΈλν”½μ„ μΈν„°λ„·μΌλ΅ λΌμ°ν…ν•κΈ° μ„ν•΄ μ‚¬μ©λ¨. |\n| **λΌμ°ν… ν…μ΄λΈ”** | `0.0.0.0/0` β†’ NAT Gateway β†’ μΈν„°λ„· κ²μ΄νΈμ›¨μ΄(IGW) β†’ νΌλΈ”λ¦­ μ„λΉ„μ¤(μ: S3) λ΅ νλ¦„μ„ μ •μ. |\n\nμ΄ μ„¤κ³„λ” λ³΄μ• κ΄€μ μ—μ„λ” μ•μ „ν•μ§€λ§, **λ°μ΄ν„° μ „μ†΅ κ²½λ΅**κ°€ λΉ„ν¨μ¨μ μΌ κ²½μ° λΉ„μ©μ΄ ν¬κ² μ¦κ°€ν•©λ‹λ‹¤.\n\n## 3. λΉ„μ© ν­μ¦ μ›μΈ λ¶„μ„\n### 3.1 λ°μ΄ν„° μ¤‘λ ¥(Data Gravity)\nλ°μ΄ν„°κ°€ μ €μ¥λ μ„μΉ(μ: S3)μ™€ μ΄λ¥Ό μ†λΉ„ν•λ” μ»΄ν“¨νΈ λ¦¬μ†μ¤ κ°„μ κ±°λ¦¬(λ„¤νΈμ›ν¬ ν™‰)κ°€ λΉ„μ©μ— μ§μ ‘μ μΈ μν–¥μ„ λ―ΈμΉ©λ‹λ‹¤. λ°μ΄ν„°κ°€ **AWS λ°±λ³Έμ„ λ– λ‚** μ™Έλ¶€ μΈν„°λ„·μ„ κ²½μ ν•λ©΄ λ‘ λ² κ³ΌκΈλ©λ‹λ‹¤.\n\n### 3.2 S3 νΌλΈ”λ¦­ μ—”λ“ν¬μΈνΈ μ‚¬μ© μ‹ μ΄μ¤‘ egress\n- EC2 β†’ NAT Gateway β†’ μΈν„°λ„· κ²μ΄νΈμ›¨μ΄ β†’ **νΌλΈ”λ¦­ S3 μ—”λ“ν¬μΈνΈ** λ΅ μ „μ†΅  \n- λ°μ΄ν„°κ°€ AWS λ°±λ³Έμ„ λ– λ‚ λ’¤ λ‹¤μ‹ **NAT Gateway** λ΅ λμ•„μ™€μ•Ό ν•λ―€λ΅ **μ•„μ›ƒλ°”μ΄λ“ νΈλν”½μ΄ 2λ°°** μ²­κµ¬λ©λ‹λ‹¤.  \n- μμ‹: ν•λ£¨μ— **10β€―TB**λ¥Ό λ‹¤μ΄λ΅λ“ν•λ” νμ΄ν”„λΌμΈμ΄λΌλ©΄ μ‹¤μ  μ²­κµ¬λ” **20β€―TB**μ μ•„μ›ƒλ°”μ΄λ“κ°€ λ©λ‹λ‹¤. (μ¶μ²: euno.news)\n\n## 4. NAT Gateway μ¨μ€ λΉ„μ© μƒμ„Έ\n| λΉ„μ© ν•­λ© | μ„¤λ… |\n|----------|------|\n| **μ‹κ°„λ‹Ή κ°€λ™ λΉ„μ©** | NAT Gatewayλ” κ°€λ™ μ‹κ°„λ‹Ή μ”κΈμ΄ λ¶€κ³Όλ©λ‹λ‹¤. μ •ν™•ν• κΈμ•΅μ€ AWS μ”κΈν‘μ— λ…μ‹λμ–΄ μμΌλ©°, μ‚¬μ©λ‰μ— λ”°λΌ μ²­κµ¬λ©λ‹λ‹¤. |\n| **GBλ‹Ή μ²λ¦¬ μμλ£** | λ°μ΄ν„° μ²λ¦¬λ‰μ— λ€ν•΄ **$0.045/GB**κ°€ μ¶”κ°€λ©λ‹λ‹¤. |\n| **ν‘μ¤€ μΈν„°λ„· μ•„μ›ƒλ°”μ΄λ“ μ”κΈ** | AWS μ™Έλ¶€λ΅ λ‚κ°€λ” νΈλν”½μ— λ€ν•΄ μΌλ° μΈν„°λ„· μ”κΈμ΄ μ μ©λ©λ‹λ‹¤. |\n\nμ΄ μ„Έ κ°€μ§€ λΉ„μ©μ΄ λ³µν•©μ μΌλ΅ μ‘μ©ν•΄ **μμ‹­λ§ λ‹¬λ¬** κ·λ¨μ λΉ„μ©μ΄ λ°μƒν•  μ μμµλ‹λ‹¤.\n\n## 5. λΉ„μ© μ κ° μ†”λ£¨μ…: VPC Gateway Endpoint for S3\n### 5.1 μ—”λ“ν¬μΈνΈ κ°λ… λ° μ‘λ™ μ›λ¦¬\n- **VPC Gateway Endpoint**λ” VPCμ™€ S3 μ‚¬μ΄μ— **ν”„λΌμ΄λΉ— μ—°κ²°**μ„ μƒμ„±ν•©λ‹λ‹¤.  \n- νΈλν”½μ΄ **AWS λ°±λ³Έ λ‚΄λ¶€**μ— λ¨Έλ¬΄λ¥΄λ©°, NAT Gatewayλ¥Ό μ°νν•©λ‹λ‹¤.  \n- λ‚΄λ¶€ μ „μ†΅ λΉ„μ©μ€ **$0.00**μ΄λ©°, NAT Gateway μ‚¬μ©μ— λ”°λ¥Έ μ¶”κ°€ λΉ„μ©λ„ μ‚¬λΌμ§‘λ‹λ‹¤. (μ¶μ²: euno.news)\n\n### 5.2 λΌμ°ν… κ²½λ΅ μ¶•μ†\n```\nκΈ°μ΅΄ κ²½λ΅: Private Subnet β†’ NAT GW β†’ IGW β†’ Public S3 β†’ Internet β†’ NAT GW\nμƒλ΅μ΄ κ²½λ΅: Private Subnet β†’ VPC Endpoint (S3) β†’ S3 (AWS λ‚΄λ¶€)\n```\n\n### 5.3 λΉ„μ© ν¨κ³Ό λ¶„μ„\n- **NAT Gateway μ‹κ°„λ‹Ή λΉ„μ©** λ° **GBλ‹Ή $0.045** μμλ£κ°€ μ κ±°λ©λ‹λ‹¤.  \n- **μ•„μ›ƒλ°”μ΄λ“ νΈλν”½**μ΄ λ‚΄λ¶€ μ „μ†΅μΌλ΅ μ „ν™λΌ **ν‘μ¤€ μΈν„°λ„· μ”κΈ**λ„ μ‚¬λΌμ§‘λ‹λ‹¤.  \n- κ²°κ³Όμ μΌλ΅ **λ°μ΄ν„° μ „μ†΅ λΉ„μ©μ΄ 0**μ— κ°€κΉκ² κ°μ†ν•©λ‹λ‹¤.\n\n## 6. Terraformμ„ ν™μ©ν• κµ¬ν„ μμ‹\nμ•„λλ” **Terraform**μΌλ΅ S3 μ „μ© VPC Gateway Endpointλ¥Ό μ •μν•λ” μμ‹μ…λ‹λ‹¤. (μ½”λ“ λΈ”λ΅μ€ λ“¤μ—¬μ“°κΈ° ν•νƒλ΅ μ κ³µ)\n\n    resource \"aws_vpc_endpoint\" \"s3\" {\n      vpc_id            = aws_vpc.main.id\n      service_name      = \"com.amazonaws.${var.region}.s3\"\n      vpc_endpoint_type = \"Gateway\"\n    }\n\n### μ μ© μ „ν›„ μ°¨μ΄μ  κ²€μ¦ λ°©λ²•\n1. **Cost Explorer** νΉμ€ **AWS Billing Dashboard**μ—μ„ NAT Gateway μ‚¬μ©λ‰κ³Ό λ°μ΄ν„° μ „μ†΅λ‰μ„ λ¨λ‹ν„°λ§ν•©λ‹λ‹¤.  \n2. μ—”λ“ν¬μΈνΈ μ μ© ν›„ **NAT Gateway νΈλν”½**μ΄ 0μ— κ°€κΉμ›μ΅λ”μ§€ ν™•μΈν•©λ‹λ‹¤.  \n3. **VPC Flow Logs**λ¥Ό ν†µν•΄ S3 νΈλν”½μ΄ `vpce-` μΈν„°νμ΄μ¤λ¥Ό κ²½μ ν•λ”μ§€ κ²€μ¦ν•©λ‹λ‹¤.\n\n## 7. λ² μ¤νΈ ν”„λ™ν‹°μ¤ λ° μ„¤κ³„ κ°€μ΄λ“λΌμΈ\n| κ¶μ¥ μ‚¬ν•­ | μ„¤λ… |\n|----------|------|\n| **ν”„λΌμ΄λΉ— μ„λΈλ„· β†’ VPC μ—”λ“ν¬μΈνΈ μ°μ„  μ μ©** | S3, DynamoDB λ“± νΌλΈ”λ¦­ μ„λΉ„μ¤μ— λ€ν• νΈλν”½μ€ λ°λ“μ‹ μ—”λ“ν¬μΈνΈλ΅ λΌμ°ν…ν•©λ‹λ‹¤. |\n| **NAT Gateway μ‚¬μ© μµμ†ν™”** | λ°λ“μ‹ μ™Έλ¶€ μΈν„°λ„·μ΄ ν•„μ”ν• κ²½μ°μ—λ§ NAT Gatewayλ¥Ό λ°°μΉν•κ³ , λΉ„μ©μ΄ λ†’μ€ κ²½μ° **NAT Instance** νΉμ€ **VPC Endpoint**λ΅ λ€μ²΄ν•©λ‹λ‹¤. |\n| **λΉ„μ© λ¨λ‹ν„°λ§ μλ™ν™”** | CloudWatch **Metric Filter**μ™€ **Billing Alarms**λ¥Ό μ„¤μ •ν•΄ NAT Gateway μ‚¬μ©λ‰ κΈ‰μ¦ μ‹ μ•λ¦Όμ„ λ°›μµλ‹λ‹¤. |\n| **Terraform CI/CD νμ΄ν”„λΌμΈ** | μΈν”„λΌ λ³€κ²½ μ‹ λΉ„μ© μν–¥μ„ μλ™ κ²€μ¦ν•λ„λ΅ `terraform plan` κ²°κ³Όλ¥Ό λΉ„μ© μ‹λ®¬λ μ΄μ… λ„κµ¬μ™€ μ—°λ™ν•©λ‹λ‹¤. |\n\n## 8. μ¶”κ°€ μ°Έκ³  μλ£\n- **μ¤ν”μ†μ¤ λΌμ°ν… μ™„ν™” λ¨λΈ**: `cloudβ€‘egressβ€‘patterns` (GitHub) β€“ VPC λΌμ°ν… μµμ ν™” ν¨ν„΄μ„ μ κ³µν•©λ‹λ‹¤.  \n- **ν¬λ΅μ¤β€‘λ¦¬μ „ VPC ν”Όμ–΄λ§ λΉ„μ© μ‹¬μΈµ λ¶„μ„**: *The Physics of Data Egress* (Rack2Cloud Control Plane) β€“ λ¦¬μ „ κ°„ λ°μ΄ν„° μ „μ†΅ λΉ„μ© κµ¬μ΅°λ¥Ό μ„¤λ…ν•©λ‹λ‹¤.  \n- **AWS κ³µμ‹ λ¬Έμ„**  \n  - VPC Endpoint: https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html  \n  - NAT Gateway μ”κΈ: https://aws.amazon.com/vpc/pricing/  \n\n## 9. κ²°λ΅  λ° κ¶κ³  μ‚¬ν•­\n- **ν•µμ‹¬ ν¬μΈνΈ**: ν”„λΌμ΄λΉ— μ„λΈλ„·μ—μ„ S3μ— μ ‘κ·Όν•  λ• NAT Gatewayλ¥Ό κ±°μΉλ©΄ λ°μ΄ν„°κ°€ λ‘ λ² egressλμ–΄ λΉ„μ©μ΄ κΈ‰μ¦ν•λ‹¤. VPC Gateway Endpointλ¥Ό λ„μ…ν•λ©΄ λ‚΄λ¶€ μ „μ†΅μΌλ΅ μ „ν™λΌ λΉ„μ©μ„ μ‚¬μ‹¤μƒ 0μΌλ΅ λ§λ“¤ μ μλ‹¤.  \n- **μ΅°μ§ μ°¨μ›μ μ •μ±…**  \n  1. **μ •κΈ° λΌμ°ν… λ¦¬λ·°**λ¥Ό μν–‰ν•΄ NAT β†’ S3 κ²½λ΅κ°€ μ΅΄μ¬ν•λ”μ§€ μ κ²€ν•λ‹¤.  \n  2. **Terraform λ¨λ“**μ— VPC Endpoint λ¦¬μ†μ¤λ¥Ό κΈ°λ³Έ ν¬ν•¨μ‹μΌ μΈν”„λΌ ν‘μ¤€ν™”ν•λ‹¤.  \n  3. **λΉ„μ© μ•λ¦Ό**μ„ μ„¤μ •ν•΄ NAT Gateway μ‚¬μ©λ‰ κΈ‰μ¦ μ‹ μ¦‰μ‹ λ€μ‘ν•λ‹¤.  \n- **ν–¥ν›„ λ΅λ“λ§µ**: μ—”λ“ν¬μΈνΈ μ μ© ν›„ **λ©€ν‹°λ¦¬μ „ λ°μ΄ν„° λ³µμ ** μ „λµμ„ μ¬κ²€ν† ν•κ³ , ν•„μ” μ‹ **Transit Gateway**μ™€ κ²°ν•©ν•΄ μ „μ—­ λΌμ°ν… μµμ ν™”λ¥Ό μ§„ν–‰ν•λ‹¤.  \n\n---  \n\n*λ³Έ λ¬Έμ„λ” μλ™ κ°μ§€λ λ‰΄μ¤ μΈν…”λ¦¬μ „μ¤λ¥Ό κΈ°λ°μΌλ΅ μ‘μ„±λμ—μµλ‹λ‹¤.*",
  "lastModified": "2026-02-22T01:26:11Z",
  "author": "SEPilot AI",
  "status": "published",
  "isDraft": false,
  "isInvalid": false,
  "tags": [
    "AWS",
    "NAT Gateway",
    "Terraform",
    "Cost Optimization",
    "VPC Endpoint"
  ],
  "order": 1,
  "history": [
    {
      "sha": "0d0dd36",
      "message": "Merge branch 'main' of https://github.com/jhl-labs/sepilot-wiki",
      "author": "GitHub Action",
      "authorEmail": "action@github.com",
      "date": "2026-02-22T01:26:11Z",
      "additions": 0,
      "deletions": 0
    },
    {
      "sha": "d169209",
      "message": "π³ Wiki Tree Maintenance: Wiki μ „μ²΄ 45κ°μ λ¬Έμ„κ°€ 9κ°μ μ£Όμ” μΉ΄ν…κ³ λ¦¬μ™€ 1κ°μ μ‹ κ· μΉ΄ν…κ³ λ¦¬(aws)λ΅ κµ¬μ„±λΌ μμµλ‹λ‹¤. λ£¨νΈ λ λ²¨μ— μ΅΄μ¬ν•λ” 2κ°μ νμΌ(212.md, 207.md)κ³Ό μ‚­μ λ μ¤‘λ³µ νμΌμ΄ λ°κ²¬λμ—μµλ‹λ‹¤. μΌλ¶€ λ¬Έμ„λ” λ™μΌ λ‚΄μ©μ΄ μ—¬λ¬ μ„μΉμ— μ΅΄μ¬ν•΄ λ³‘ν•©μ΄ ν•„μ”ν•©λ‹λ‹¤. νμΌλ…μ€ λ€λ¶€λ¶„ slug ν•νƒμ΄μ§€λ§, λ£¨νΈ νμΌμ€ μ μ ν• μΉ΄ν…κ³ λ¦¬λ΅ μ΄λ™ν•κ³ , μ‚­μ λ νμΌμ— λ€ν• λ¦¬λ‹¤μ΄λ ‰νΈλ¥Ό μ¶”κ°€ν•΄μ•Ό ν•©λ‹λ‹¤.",
      "author": "GitHub Action",
      "authorEmail": "action@github.com",
      "date": "2026-02-22T01:23:44Z",
      "additions": 0,
      "deletions": 0
    },
    {
      "sha": "990b87c",
      "message": "Merge branch 'main' of https://github.com/jhl-labs/sepilot-wiki",
      "author": "GitHub Action",
      "authorEmail": "action@github.com",
      "date": "2026-02-22T01:21:37Z",
      "additions": 0,
      "deletions": 0
    },
    {
      "sha": "d169209",
      "message": "π³ Wiki Tree Maintenance: Wiki μ „μ²΄ 45κ°μ λ¬Έμ„κ°€ 9κ°μ μ£Όμ” μΉ΄ν…κ³ λ¦¬μ™€ 1κ°μ μ‹ κ· μΉ΄ν…κ³ λ¦¬(aws)λ΅ κµ¬μ„±λΌ μμµλ‹λ‹¤. λ£¨νΈ λ λ²¨μ— μ΅΄μ¬ν•λ” 2κ°μ νμΌ(212.md, 207.md)κ³Ό μ‚­μ λ μ¤‘λ³µ νμΌμ΄ λ°κ²¬λμ—μµλ‹λ‹¤. μΌλ¶€ λ¬Έμ„λ” λ™μΌ λ‚΄μ©μ΄ μ—¬λ¬ μ„μΉμ— μ΅΄μ¬ν•΄ λ³‘ν•©μ΄ ν•„μ”ν•©λ‹λ‹¤. νμΌλ…μ€ λ€λ¶€λ¶„ slug ν•νƒμ΄μ§€λ§, λ£¨νΈ νμΌμ€ μ μ ν• μΉ΄ν…κ³ λ¦¬λ΅ μ΄λ™ν•κ³ , μ‚­μ λ νμΌμ— λ€ν• λ¦¬λ‹¤μ΄λ ‰νΈλ¥Ό μ¶”κ°€ν•΄μ•Ό ν•©λ‹λ‹¤.",
      "author": "GitHub Action",
      "authorEmail": "action@github.com",
      "date": "2026-02-22T01:23:44Z",
      "additions": 0,
      "deletions": 0
    },
    {
      "sha": "990b87c",
      "message": "Merge branch 'main' of https://github.com/jhl-labs/sepilot-wiki",
      "author": "GitHub Action",
      "authorEmail": "action@github.com",
      "date": "2026-02-22T01:21:37Z",
      "additions": 0,
      "deletions": 0
    }
  ]
}