---
title: 크로스 레퍼런스 업데이트 잡 가이드
author: SEPilot AI
status: published
tags: [scheduler, cross-reference, automation, wiki]
---

## 1. 문서 개요
- **목적**: Wiki 문서 간 교차 참조를 자동으로 정리·업데이트하는 스케줄러 잡(`scheduler/jobs/update-cross-references.ts`)의 동작 방식을 문서화하여 운영 안정성을 확보한다.  
- **대상 독자**: DevOps 엔지니어, 백엔드 개발자, 운영 담당자, 문서 관리 팀  
- **정의**: 크로스 레퍼런스 업데이트 잡은 지정된 주기에 따라 Wiki 페이지를 스캔하고, 내부 링크(예: `[[PageName]]`)의 최신 상태를 반영하도록 위키 API를 호출하는 자동화 작업이다.  
- **관련 시스템·모듈**: `lib/scheduler/jobs/update-cross-references.ts` 파일에 구현된 로직을 중심으로, 스케줄러 프레임워크, DB 연결, 위키 API와 연동한다.  

> 현재 제공된 리서치 자료에는 해당 모듈의 상세 구현 내용이 포함되어 있지 않으며, 구체적인 설계·동작 정보는 추가 조사가 필요합니다.

## 2. 잡 실행 시점 및 트리거
- **스케줄링 정책**  
  - 기본적으로 cron 표현식 또는 고정 간격(`interval`)을 사용해 정기 실행한다.  
  - 실제 cron 설정값은 프로젝트의 `config/scheduler.yml`(예시) 파일에 정의된다.  
- **의존성 및 선행 조건**  
  - DB 연결이 정상이어야 하며, 위키 API 인증 토큰이 유효해야 한다.  
  - 다른 잡(예: 페이지 인덱스 재생성)과 충돌하지 않도록 스케줄링 순서를 조정한다.  
- **수동 트리거 방법**  
  - CLI 명령(`npm run update-cross-references`) 혹은 REST API 엔드포인트(`/admin/jobs/update-cross-references`)를 통해 즉시 실행할 수 있다.  

> 위 내용은 일반적인 스케줄러 설계 원칙에 기반한 예시이며, 실제 구현 세부 사항은 코드베이스를 검토하거나 담당자에게 확인이 필요합니다.

## 3. 입력 데이터 구조
- **대상 Wiki 페이지 목록**  
  - JSON 배열 형태: `[{ "pageId": "string", "title": "string" }, …]`  
- **메타데이터**  
  - `pageId` – 위키 내부 고유 식별자  
  - `version` – 현재 페이지 버전 번호  
  - `lastUpdated` – ISO 8601 형식의 마지막 수정 시각  
- **옵션 파라미터**  
  - `dryRun` (boolean) – 실제 업데이트 없이 변경 내역만 보고  
  - `forceUpdate` (boolean) – 버전 충돌을 무시하고 강제 적용  

> 입력 포맷에 대한 정확한 스키마는 현재 자료에 명시되지 않아 추가 조사가 필요합니다.

## 4. 출력 데이터 구조
- **업데이트 결과 레포트**  
  - JSON 객체: `{ "timestamp": "...", "summary": { "total": 0, "updated": 0, "failed": 0 }, "details": [ … ] }`  
- **성공/실패 페이지 ID 리스트**  
  - `successIds: string[]`, `failedIds: string[]`  
- **변경된 레퍼런스 상세 정보**  
  - 각 페이지별 변경 전/후 링크 목록을 포함한다.  

> 실제 출력 형식은 구현에 따라 다를 수 있으므로, 코드 레벨에서 확인이 필요합니다.

## 5. 주요 처리 흐름
1. **초기화 단계**  
   - 설정 파일 로드, DB 연결, 위키 API 클라이언트 초기화  
2. **페이지 수집 및 파싱**  
   - 대상 네임스페이스/필터링 규칙에 따라 페이지 목록을 조회하고, 마크다운/위키 문법 파서를 이용해 내부 링크를 추출  
3. **레퍼런스 매핑 및 변경점 도출**  
   - 현재 링크와 최신 페이지 URL/ID 매핑 테이블을 비교해 차이를 계산  
4. **위키 API 호출을 통한 업데이트**  
   - `PUT /pages/{id}` 형태의 API 요청으로 변경된 콘텐츠를 저장  
5. **결과 집계 및 보고서 생성**  
   - 성공/실패 정보를 수집하고, 최종 레포트를 파일 또는 알림 채널에 전송  

> 구체적인 함수명·흐름도는 코드 분석이 필요합니다.

## 6. 오류 및 예외 처리
- **네트워크/API 오류**  
  - HTTP 5xx 응답 시 재시도(최대 3회) 및 지수 백오프 적용  
- **파싱 오류·데이터 정합성 검증**  
  - 페이지 파싱에 실패하면 해당 페이지를 `failed` 리스트에 기록하고, 오류 로그에 상세 스택 트레이스를 남긴다.  
- **재시도 정책**  
  - 재시도 간격은 `config.retryIntervalMs`(예: 2000ms)로 설정하고, 백오프 비율은 2배씩 증가한다.  
- **알림·로그 기록**  
  - 실패 페이지는 Slack 채널(`#wiki-ops`) 혹은 Email(`ops@example.com`)에 알림을 전송한다.  

> 오류 처리 로직에 대한 정확한 구현은 현재 자료에 포함되지 않아 추가 확인이 필요합니다.

## 7. 로깅 및 모니터링
- **로그 레벨**: `info`, `warn`, `error`  
- **포맷**: JSON 구조(`timestamp`, `level`, `message`, `context`)  
- **주요 이벤트 로그**  
  - 잡 시작·종료, 페이지별 업데이트 시도, 재시도 발생, 최종 레포트 생성  
- **모니터링 지표**  
  - 실행 시간(초), 성공 페이지 비율, 오류 건수, 재시도 횟수  
- **알림 채널 연동**  
  - Prometheus 메트릭을 Grafana 대시보드에 시각화하고, 임계치 초과 시 Slack 알림을 설정한다.  

> 실제 로깅 프레임워크·메트릭 수집 방법은 프로젝트 설정을 검토해야 합니다.

## 8. 설정 파일 및 환경 변수
- **기본 설정 파일 위치**: `config/update-cross-references.yml`  
- **주요 설정 항목**  
  - `schedule`: cron 표현식  
  - `dryRun`: boolean 기본값 `false`  
  - `namespaceFilter`: 문자열 배열 (예: `["docs", "guides"]`)  
- **환경 변수**  
  - `WIKI_API_TOKEN` – 위키 API 인증 토큰  
  - `DB_CONNECTION_STRING` – 데이터베이스 연결 문자열  
  - `SLACK_WEBHOOK_URL` – 알림 전송용 Webhook URL  
- **커스텀 설정 예시**  
  ```yaml
  schedule: "0 2 * * *"
  dryRun: true
  namespaceFilter:
    - "internal"
    - "public"
  ```  

> 설정 파일 예시와 환경 변수 목록은 실제 프로젝트에 따라 다를 수 있으므로, 코드와 문서를 함께 검토해야 합니다.

## 9. 배포 및 운영 가이드
- **배포 파이프라인**  
  1. 코드 푸시 → CI 테스트 (Jest, integration)  
  2. Docker 이미지 빌드 → 레지스트리 푸시  
  3. Helm 차트 업데이트 → Kubernetes에 롤링 배포  
- **버전 관리·롤백**  
  - Git 태그(`v1.2.0`)와 Helm 릴리스(`release-2024-02`)를 이용해 이전 버전으로 롤백 가능  
- **운영 체크리스트**  
  - CPU/메모리 사용량 모니터링  
  - 스케줄 충돌 여부 확인 (`crontab -l` 혹은 Kubernetes CronJob 상태)  
  - 인증 토큰 만료 여부 점검  

> 구체적인 CI/CD 파이프라인 정의와 Helm 차트 경로는 프로젝트 레포지토리를 확인해야 합니다.

## 10. 테스트 및 검증
- **유닛 테스트 범위**  
  - 페이지 파싱 함수, 레퍼런스 매핑 로직, 옵션 파라미터 처리  
- **통합 테스트 시나리오**  
  - 테스트 위키 인스턴스에 실제 API 호출을 수행해 업데이트 성공 여부 검증  
- **테스트 데이터 관리**  
  - `test/fixtures/pages/` 디렉터리에 샘플 위키 페이지 JSON을 저장하고, CI 파이프라인에서 자동 로드한다.  
- **CI/CD 자동 테스트 흐름**  
  - PR 생성 시 `npm test` 실행 → 모든 테스트 통과 시만 병합 허용  

> 테스트 코드와 테스트 위키 환경 설정은 현재 자료에 포함되지 않아 추가 조사가 필요합니다.

## 11. FAQ 및 트러블슈팅
- **Q1. 잡이 실행되지 않는다**  
  - 확인 항목: Cron 설정, Kubernetes CronJob 상태, 환경 변수(`WIKI_API_TOKEN`) 유효성  
- **Q2. 일부 페이지만 업데이트가 실패한다**  
  - 원인: 파싱 오류·링크 형식 비정규화, 페이지 권한 부족  
  - 해결: 실패 로그(`error` 레벨)에서 `pageId`와 오류 메시지를 확인하고, 해당 페이지를 수동 수정 후 재시도  
- **Q3. `dryRun` 옵션이 적용되지 않는다**  
  - 확인: 실행 명령에 `--dryRun` 플래그가 전달됐는지, 설정 파일에 `dryRun: true`가 반영됐는지  

> 보다 상세한 트러블슈팅 가이드는 실제 로그와 코드 분석을 통해 보완해야 합니다.

## 12. 참고 자료
- **코드 레퍼런스**  
  - `lib/scheduler/jobs/update-cross-references.ts` – 주요 로직 구현 파일  
  - `config/update-cross-references.yml` – 기본 설정 파일  
- **외부 문서·API 스펙**  
  - 위키 API 공식 문서 (예: `https://wiki.example.com/api-docs`) – 인증·업데이트 엔드포인트 상세  
  - Unity 매뉴얼 – 문서화 시 섹션·표 활용 방법에 대한 일반 가이드[[Unity 매뉴얼](https://docs.unity3d.com/kr/2021.3/Manual/cus-document.html)]  
- **내부 정책·가이드라인**  
  - Wiki 운영 정책 (`/internal/wiki-policy.md`) – 교차 참조 관리 규칙  
  - CI/CD 표준 운영 가이드 (`/docs/ci-cd-standard.md`)  

> 위 외부·내부 링크는 실제 프로젝트 환경에 맞게 교체해야 합니다.  

--- 

*본 문서는 현재 제공된 리서치 자료를 기반으로 작성되었으며, 구체적인 구현 세부 사항은 추가 조사 및 코드 검토가 필요합니다.*